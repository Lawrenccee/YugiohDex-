function setListenerDD(a){a.addEventListener("mouseover",function(){modalImageDD.setAttribute("src",a.getAttribute("src")),attackValueDD.innerHTML=a.getAttribute("attack"),defenseValueDD.innerHTML=a.getAttribute("defense"),descriptionValueDD.innerHTML=a.getAttribute("description"),nameValueDD.innerHTML=a.getAttribute("name")})}function createCardViewDD(a){const b=document.createElement("div");b.className="col-sm-2 col-xs-6";const c=document.createElement("button");c.className="btn btn-link",c.setAttribute("data-target","#card_detail_modal"),c.setAttribute("data-toggle","modal"),b.appendChild(c);const d=document.createElement("img");d.className="img-responsive";var e=a.storageURL,f=a.name;return d.setAttribute("name",f),d.setAttribute("attack",a.attack),d.setAttribute("defense",a.defense),d.setAttribute("description",a.description),d.setAttribute("src",e),d.setAttribute("alt",f),setListenerDD(d),c.appendChild(d),b}function uid(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function setEditListener(){editButton.addEventListener("mouseover",function(){localStorage.setItem("cardLength",Object.keys(userCards).length);var a=-1;for(var b in userCards)a++,localStorage.setItem(""+a,userCards[b]);var c=""+a;localStorage.setItem("index",c),localStorage.setItem("willEdit",!0),localStorage.setItem("editDeckName",editDeckName),localStorage.setItem("editDeckID",editID)})}var dbDeckRef=firebase.database().ref().child("decks"),dbCardsRef=firebase.database().ref().child("cards");const modalImageDD=document.getElementById("modalImageDD"),attackValueDD=document.getElementById("attackValueDD"),defenseValueDD=document.getElementById("defenseValueDD"),descriptionValueDD=document.getElementById("descriptionValueDD"),nameValueDD=document.getElementById("nameValueDD");var isUser=localStorage.getItem("isUser");const editButton=document.getElementById("editButton"),deleteButton=document.getElementById("deleteButton");1!=isUser&&"true"!=isUser||(editButton.setAttribute("style","visibility:visible"),deleteButton.setAttribute("style","visibility:visible"));const deckID=document.getElementById("deckID");deckID.innerHTML=localStorage.getItem("deckName");var editDeckName=localStorage.getItem("deckName"),editID=localStorage.getItem("deckID"),viewID=localStorage.getItem("viewDeckID");const cardGalleryRow=document.getElementById("cardGalleryRow"),userCards={};firebase.database().ref("/decks/").once("value").then(function(a){var b=a.val();for(var c in b){var d=b[c];if(d.deckName==deckID.textContent){var e=d.cards;for(var f in e)userCards[f]=e[f],firebase.database().ref("/cards/"+e[f]).once("value").then(function(a){var b=a.val();cardGalleryRow.appendChild(createCardViewDD(b))})}}setEditListener()});const commentBtn=document.getElementById("commentBtn"),commentsList=document.getElementById("commentList"),commentsRef=firebase.database().ref().child("/decks/"+viewID+"/comments/");commentsRef.on("child_added",function(a){var b=a.val();const c=document.createElement("li");c.className="list-group-item";const d=document.createElement("blockquote");d.innerHTML=b.content;const e=document.createElement("cite");e.innerHTML=b.email;const f=document.createElement("p");f.innerHTML=b.date,c.setAttribute("email",b.email),c.appendChild(d),c.appendChild(e),c.appendChild(f);const g=document.createElement("input");g.setAttribute("type","button"),g.setAttribute("class","btn btn-danger"),g.setAttribute("value","delete"),g.addEventListener("click",function(){var b={},c=a.key+"";b["/decks/"+viewID+"/comments/"+c]=null,firebase.database().ref().update(b)}),c.appendChild(g),commentsList.appendChild(c)}),commentsRef.on("child_removed",function(a){console.log("Removing from commentsList");for(var b=a.val().email,c=0;c<commentsList.childNodes.length;c++)"li"==commentsList.childNodes[c].nodeName.toLowerCase()&&commentsList.childNodes[c].getAttribute("email")==b&&commentsList.removeChild(commentsList.childNodes[c])}),deleteButton.addEventListener("click",function(){if(null!=editID){var a=editID,b={};b["/decks/"+a]=null,b["/users/"+firebase.auth().currentUser.uid+"/decks/"+a]=null,firebase.database().ref().update(b),alert("Your deck was successfully deleted")}}),commentBtn.addEventListener("click",function(){if(!firebase.auth().currentUser)return void alert("Account requried to post content. Please create account or log in.");var a=uid(),b="",c="",d=document.getElementById("comments");null!=firebase.auth().currentUser&&(b=firebase.auth().currentUser.email,c=firebase.auth().currentUser.uid);var e=d.value,f=new Date,g=f.getDate(),h=f.getMonth()+1,i=f.getFullYear();g<10&&(g="0"+g),h<10&&(h="0"+h),f=h+"/"+g+"/"+i;var j={content:e,date:f,email:b,uid:c};commentsRef.child(a).set(j),d.value=""});